<script>
    document.addEventListener('DOMContentLoaded', () => {
        const socket = io();
        const userId = '<%= user.id %>';
        const userRole = '<%= user.role %>';
        
        // Prze켹adowywanie okna, gdy driver zaakceptuje zaproszenie
        if (userRole === 'spedytor') {
            socket.on('driver_accepted', () => {
                window.location.reload();
            });
        }
    });
</script>
<div id="spedytor-dashboard">

    <div class="drivers-section">
        <div class="available-drivers">
            <h3>Dost캧pni kierowcy</h3>
            <div class="drivers-grid">
                <% freeDrivers.forEach(driver => { %>
                    <div class="driver-card">
                        <div class="driver-name"><%= driver.firstName %> <%= driver.lastName %></div>
                        <div class="status-indicator <%= driver.isOnline ? 'online' : 'offline' %>" 
                             data-user-status="<%= driver._id %>">
                            <%= driver.isOnline ? '游릭' : '游댮' %>
                        </div>
                        <form action="/api/job/invite-driver/<%= driver._id %>" method="POST">
                            <button type="submit" class="btn-invite">Zapro콑 do zespo켹u</button>
                        </form>
                    </div>
                <% }) %>
            </div>
        </div>

        <div class="managed-drivers">
            <h3>M칩j zesp칩켹</h3>
            <div class="drivers-grid">
                <% managedDrivers.forEach(driver => { %>
                    <div class="driver-card">
                        <div class="driver-name">
                            <%= driver.firstName %> <%= driver.lastName %>
                        </div>
                        <div class="status-indicator <%= driver.isOnline ? 'online' : 'offline' %>" 
                             data-user-status="<%= driver._id %>">
                            <%= driver.isOnline ? '游릭' : '游댮' %>
                        </div>
                        <button onclick="removeDriver('<%= driver._id %>')" class="btn-remove">
                            Usu켻 z zespo켹u
                        </button>
                    </div>
                <% }) %>
            </div>
        </div>
    </div>

    <table id="accepted-jobs" class="jobs-table">
        <h3>Przyj캧te zlecenia</h3>
        <thead>
            <tr>
                <th>Cena</th>
                <th>Waga</th>
                <th>Wymiary</th>
                <th>Adres odbioru</th>
                <th>Data odbioru</th>
                <th>Adres dostawy</th>
                <th>Data dostawy</th>
                <th>Odleg켹o콑캖</th>
                <th>Status</th>
                <th>Data utworzenia</th>
            </tr>
        </thead>
        <tbody>
            <% acceptedJobs.forEach(job => { %>
                <tr>
                    <td><%= job.price %> PLN</td>
                    <td><%= job.weight %> kg</td>
                    <td><%= job.dimensions.length %>x<%= job.dimensions.width %>x<%= job.dimensions.height %> cm</td>
                    <td><%= job.pickup.address %></td>
                    <td><%= new Date(job.pickup.date).toLocaleString() %></td>
                    <td><%= job.delivery.address %></td>
                    <td><%= new Date(job.delivery.date).toLocaleString() %></td>
                    <td><%= job.distance %> km</td>
                    <td class="status-<%= job.status %>"><%= job.status %></td>
                    <td><%= new Date(job.createdAt).toLocaleString() %></td>
                </tr>
            <% }); %>
        </tbody>
    </table>

    <table id="all-jobs" class="jobs-table">
        <h3>Wszystkie zlecenia</h3>
        <thead>
            <tr>
                <th>Cena</th>
                <th>Waga</th>
                <th>Wymiary</th>
                <th>Adres odbioru</th>
                <th>Data odbioru</th>
                <th>Adres dostawy</th>
                <th>Data dostawy</th>
                <th>Odleg켹o콑캖</th>
                <th>Status</th>
                <th>Data utworzenia</th>
                <th>Akcje</th>
            </tr>
        </thead>
        <tbody>
    <% jobs.forEach(job => { %>
        <tr>
            <td><%= job.price %> PLN</td>
            <td><%= job.weight %> kg</td>
            <td><%= job.dimensions.length %>x<%= job.dimensions.width %>x<%= job.dimensions.height %> cm</td>
            <td><%= job.pickup.address %></td>
            <td><%= new Date(job.pickup.date).toLocaleString() %></td>
            <td><%= job.delivery.address %></td>
            <td><%= new Date(job.delivery.date).toLocaleString() %></td>
            <td><%= job.distance %> km</td>
            <td class="status-<%= job.status %>"><%= job.status %></td>
            <td><%= new Date(job.createdAt).toLocaleString() %></td>
            <td>
                <% if (job.status === 'active') { %>
                    <form action="/api/job/<%= job._id %>/accept" method="POST">
                        <button type="submit" class="accept-btn">Przyjmij zlecenie</button>
                    </form>
                <% } %>
            </td>
        </tr>
    <% }); %>
</tbody>
</table>
</div>